{"ast":null,"code":"import { amplifyUuid } from '../../../utils/amplifyUuid/index.mjs';\nimport { getClientInfo } from '../../../utils/getClientInfo/getClientInfo.mjs';\nimport '../../../utils/retry/retry.mjs';\nimport '@aws-crypto/sha256-js';\nimport '@smithy/util-hex-encoding';\nimport '../../../awsClients/pinpoint/base.mjs';\nimport '../../../awsClients/pinpoint/errorHelpers.mjs';\nimport { updateEndpoint as updateEndpoint$1 } from '../../../awsClients/pinpoint/updateEndpoint.mjs';\nimport { cacheEndpointId } from '../utils/cacheEndpointId.mjs';\nimport { createEndpointId, clearCreatedEndpointId } from '../utils/createEndpointId.mjs';\nimport { getEndpointId } from '../utils/getEndpointId.mjs';\n\n// Copyright Amazon.com, Inc. or its affiliates. All Rights Reserved.\n// SPDX-License-Identifier: Apache-2.0\n/**\n * @internal\n */\nconst updateEndpoint = async ({\n  address,\n  appId,\n  category,\n  channelType,\n  credentials,\n  identityId,\n  optOut,\n  region,\n  userAttributes,\n  userId,\n  userProfile,\n  userAgentValue\n}) => {\n  const endpointId = await getEndpointId(appId, category);\n  // only generate a new endpoint id if one was not found in cache\n  const createdEndpointId = !endpointId ? createEndpointId(appId, category) : undefined;\n  const {\n    customProperties,\n    demographic,\n    email,\n    location,\n    metrics,\n    name,\n    plan\n  } = userProfile ?? {};\n  const clientInfo = getClientInfo();\n  const mergedDemographic = {\n    appVersion: clientInfo.appVersion,\n    make: clientInfo.make,\n    model: clientInfo.model,\n    modelVersion: clientInfo.version,\n    platform: clientInfo.platform,\n    ...demographic\n  };\n  const shouldAddAttributes = email || customProperties || name || plan;\n  const attributes = {\n    ...(email && {\n      email: [email]\n    }),\n    ...(name && {\n      name: [name]\n    }),\n    ...(plan && {\n      plan: [plan]\n    }),\n    ...customProperties\n  };\n  const input = {\n    ApplicationId: appId,\n    EndpointId: endpointId ?? createdEndpointId,\n    EndpointRequest: {\n      RequestId: amplifyUuid(),\n      EffectiveDate: new Date().toISOString(),\n      ChannelType: channelType,\n      Address: address,\n      Attributes: shouldAddAttributes ? attributes : undefined,\n      Demographic: {\n        AppVersion: mergedDemographic.appVersion,\n        Locale: mergedDemographic.locale,\n        Make: mergedDemographic.make,\n        Model: mergedDemographic.model,\n        ModelVersion: mergedDemographic.modelVersion,\n        Platform: mergedDemographic.platform,\n        PlatformVersion: mergedDemographic.platformVersion,\n        Timezone: mergedDemographic.timezone\n      },\n      Location: {\n        City: location?.city,\n        Country: location?.country,\n        Latitude: location?.latitude,\n        Longitude: location?.longitude,\n        PostalCode: location?.postalCode,\n        Region: location?.region\n      },\n      Metrics: metrics,\n      OptOut: optOut,\n      User: {\n        UserId: userId ?? identityId,\n        UserAttributes: userAttributes\n      }\n    }\n  };\n  try {\n    await updateEndpoint$1({\n      credentials,\n      region,\n      userAgentValue\n    }, input);\n    // if we had to create an endpoint id, we need to now cache it\n    if (createdEndpointId) {\n      await cacheEndpointId(appId, category, createdEndpointId);\n    }\n  } finally {\n    // at this point, we completely reset the behavior so even if the update was unsuccessful\n    // we can just start over with a newly created endpoint id\n    if (createdEndpointId) {\n      clearCreatedEndpointId(appId, category);\n    }\n  }\n};\nexport { updateEndpoint };","map":{"version":3,"names":["updateEndpoint","address","appId","category","channelType","credentials","identityId","optOut","region","userAttributes","userId","userProfile","userAgentValue","endpointId","getEndpointId","createdEndpointId","createEndpointId","undefined","customProperties","demographic","email","location","metrics","name","plan","clientInfo","getClientInfo","mergedDemographic","appVersion","make","model","modelVersion","version","platform","shouldAddAttributes","attributes","input","ApplicationId","EndpointId","EndpointRequest","RequestId","amplifyUuid","EffectiveDate","Date","toISOString","ChannelType","Address","Attributes","Demographic","AppVersion","Locale","locale","Make","Model","ModelVersion","Platform","PlatformVersion","platformVersion","Timezone","timezone","Location","City","city","Country","country","Latitude","latitude","Longitude","longitude","PostalCode","postalCode","Region","Metrics","OptOut","User","UserId","UserAttributes","updateEndpoint$1","cacheEndpointId","clearCreatedEndpointId"],"sources":["/Users/kazuyamorooka/Desktop/coffee_app/code/node_modules/@aws-amplify/core/src/providers/pinpoint/apis/updateEndpoint.ts"],"sourcesContent":["// Copyright Amazon.com, Inc. or its affiliates. All Rights Reserved.\n// SPDX-License-Identifier: Apache-2.0\nimport { amplifyUuid } from '../../../utils/amplifyUuid';\nimport { getClientInfo } from '../../../utils/getClientInfo';\nimport { updateEndpoint as clientUpdateEndpoint, } from '../../../awsClients/pinpoint';\nimport { cacheEndpointId } from '../utils/cacheEndpointId';\nimport { clearCreatedEndpointId, createEndpointId, } from '../utils/createEndpointId';\nimport { getEndpointId } from '../utils/getEndpointId';\n/**\n * @internal\n */\nexport const updateEndpoint = async ({ address, appId, category, channelType, credentials, identityId, optOut, region, userAttributes, userId, userProfile, userAgentValue, }) => {\n    const endpointId = await getEndpointId(appId, category);\n    // only generate a new endpoint id if one was not found in cache\n    const createdEndpointId = !endpointId\n        ? createEndpointId(appId, category)\n        : undefined;\n    const { customProperties, demographic, email, location, metrics, name, plan, } = userProfile ?? {};\n    const clientInfo = getClientInfo();\n    const mergedDemographic = {\n        appVersion: clientInfo.appVersion,\n        make: clientInfo.make,\n        model: clientInfo.model,\n        modelVersion: clientInfo.version,\n        platform: clientInfo.platform,\n        ...demographic,\n    };\n    const shouldAddAttributes = email || customProperties || name || plan;\n    const attributes = {\n        ...(email && { email: [email] }),\n        ...(name && { name: [name] }),\n        ...(plan && { plan: [plan] }),\n        ...customProperties,\n    };\n    const input = {\n        ApplicationId: appId,\n        EndpointId: endpointId ?? createdEndpointId,\n        EndpointRequest: {\n            RequestId: amplifyUuid(),\n            EffectiveDate: new Date().toISOString(),\n            ChannelType: channelType,\n            Address: address,\n            Attributes: shouldAddAttributes ? attributes : undefined,\n            Demographic: {\n                AppVersion: mergedDemographic.appVersion,\n                Locale: mergedDemographic.locale,\n                Make: mergedDemographic.make,\n                Model: mergedDemographic.model,\n                ModelVersion: mergedDemographic.modelVersion,\n                Platform: mergedDemographic.platform,\n                PlatformVersion: mergedDemographic.platformVersion,\n                Timezone: mergedDemographic.timezone,\n            },\n            Location: {\n                City: location?.city,\n                Country: location?.country,\n                Latitude: location?.latitude,\n                Longitude: location?.longitude,\n                PostalCode: location?.postalCode,\n                Region: location?.region,\n            },\n            Metrics: metrics,\n            OptOut: optOut,\n            User: {\n                UserId: userId ?? identityId,\n                UserAttributes: userAttributes,\n            },\n        },\n    };\n    try {\n        await clientUpdateEndpoint({ credentials, region, userAgentValue }, input);\n        // if we had to create an endpoint id, we need to now cache it\n        if (createdEndpointId) {\n            await cacheEndpointId(appId, category, createdEndpointId);\n        }\n    }\n    finally {\n        // at this point, we completely reset the behavior so even if the update was unsuccessful\n        // we can just start over with a newly created endpoint id\n        if (createdEndpointId) {\n            clearCreatedEndpointId(appId, category);\n        }\n    }\n};\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}